<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Voice of Customer Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>

<div class="dashboard">

  <!-- FILTER PANEL (UI ONLY FOR NOW) -->
  <aside class="filters">
    <h2>Filters</h2>

    <label>Business Name</label>
    <select>
      <option>Metro</option>
    </select>

    <label>Zone</label>
    <input placeholder="Search zone" />

    <label>State</label>
    <input placeholder="Search state" />

    <label>City</label>
    <input placeholder="Search city" />

    <label>Store</label>
    <input placeholder="Search store" />

    <label>Financial Year</label>
    <div>
      <input type="checkbox" checked /> FY2022â€“2023
    </div>

    <button class="reset">Reset Filters</button>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="content">

    <header class="topbar">
      <button class="toggle">Hide Filters</button>
      <h1>Voice of Customer Dashboard</h1>
    </header>

    <!-- KPI CARDS -->
    <section class="kpis">
      <div class="card">
        <p>Total Reviews</p>
        <h2 id="kpiTotalReviews">?</h2>
      </div>

      <div class="card">
        <p>% Negative Reviews</p>
        <h2 id="kpiNegativePct">?</h2>
      </div>

      <div class="card">
        <p>Best / Worst Store</p>
        <h2 id="kpiBestWorst">?</h2>
      </div>
    </section>

    <!-- STRATEGIC INSIGHTS (STATIC FOR NOW) -->
    <section class="insights">
      <h2>Strategic Insights</h2>

      <div class="insight-cards">
        <div class="insight gray">
          <h3>Store Experience Dominates</h3>
          <p>Primary driver of praise and criticism.</p>
        </div>

        <div class="insight blue">
          <h3>Regional Sentiment Dip</h3>
          <p>Zone-level decline detected.</p>
        </div>

        <div class="insight yellow">
          <h3>Stores Needing Attention</h3>
          <p>Lowest rated locations identified.</p>
        </div>
      </div>
    </section>

    <p class="placeholder">Charts and comments will render below.</p>

  </main>
</div>

<!-- =========================
     STEP 1: LOAD JSON DATA
========================= -->
<script>
let reviewsData = [];

fetch("reviewsData.json")
  .then(response => {
    if (!response.ok) {
      throw new Error("Failed to load reviewsData.json");
    }
    return response.json();
  })
  .then(data => {
    reviewsData = data;
    initializeDashboard();
  })
  .catch(error => {
    console.error("Error loading data:", error);
  });
</script>

<!-- =========================
     STEP 2: DASHBOARD LOGIC
========================= -->
<script>
function initializeDashboard() {
  updateKPIs(reviewsData);
}

function updateKPIs(data) {

  // Total Reviews
  document.getElementById("kpiTotalReviews").innerText = data.length;

  // % Negative Reviews
  const negativeCount = data.filter(d => d.sentiment === "Negative").length;
  const negativePct = data.length
    ? ((negativeCount / data.length) * 100).toFixed(1)
    : 0;

  document.getElementById("kpiNegativePct").innerText = negativePct + "%";

  // Best / Worst Store
  const storeRatings = {};

  data.forEach(d => {
    if (!storeRatings[d.store_name]) {
      storeRatings[d.store_name] = [];
    }
    storeRatings[d.store_name].push(d.google_rating);
  });

  const averages = Object.entries(storeRatings).map(([store, ratings]) => ({
    store,
    avg: ratings.reduce((a, b) => a + b, 0) / ratings.length
  }));

  averages.sort((a, b) => b.avg - a.avg);

  const best = averages[0]?.store || "-";
  const worst = averages[averages.length - 1]?.store || "-";

  document.getElementById("kpiBestWorst").innerText =
    best + " / " + worst;
}
</script>

</body>
</html>
